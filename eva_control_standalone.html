<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>EVA Robot - Controle</title>
<style>
body{background:#0f172a;color:white;font-family:sans-serif}
button,input{font-size:16px;margin:5px}
img{max-width:640px;border:2px solid #555}
</style>
</head>
<body>

<h1>ü§ñ EVA Robot</h1>

<div>
<input id="robot-ip" placeholder="IP do Raspberry">
<button id="btn-connect">Conectar</button>
<span id="status-text">Desconectado</span>
</div>

<div>
<img id="camera-feed">
</div>

<div>
<button id="btn-forward">Frente</button>
<button id="btn-backward">R√©</button>
<button id="btn-left">Esq</button>
<button id="btn-right">Dir</button>
<button id="btn-stop">STOP</button>
</div>

<div>
<button id="btn-camera-usb">USB</button>
<button id="btn-camera-picam">PiCam</button>
<button id="btn-disable-arm">Desativar bra√ßo</button>
</div>

<div>
<label>Base <input type="range" id="base-slider" min="0" max="180"></label>
<label>Ombro <input type="range" id="shoulder-slider" min="0" max="180"></label>
<label>Cotovelo <input type="range" id="elbow-slider" min="0" max="180"></label>
<label>Cabe√ßa <input type="range" id="head-slider" min="0" max="180"></label>
</div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{

const WS_PORT = 8765;
let ws=null;
let connected=false;

const robotIPInput=document.getElementById("robot-ip");
const btnConnect=document.getElementById("btn-connect");
const statusText=document.getElementById("status-text");
const cameraFeed=document.getElementById("camera-feed");

btnConnect.onclick=()=>{
    const ip=robotIPInput.value.trim();
    if(!ip) return alert("Digite o IP");
    ws=new WebSocket(`ws://${ip}:${WS_PORT}`);

    ws.onopen=()=>{
        connected=true;
        statusText.textContent="Conectado";
    };

    ws.onclose=()=>{
        connected=false;
        statusText.textContent="Desconectado";
    };

    ws.onmessage=e=>{
        const msg=JSON.parse(e.data);
        if(msg.type==="camera_frame"){
            cameraFeed.src="data:image/jpeg;base64,"+msg.data;
        }
    };
};

function send(cmd,params={}){
    if(connected) ws.send(JSON.stringify({cmd,params}));
}

document.getElementById("btn-forward").onclick=()=>send("drive",{vx:0.5});
document.getElementById("btn-backward").onclick=()=>send("drive",{vx:-0.5});
document.getElementById("btn-left").onclick=()=>send("drive",{vz:0.5});
document.getElementById("btn-right").onclick=()=>send("drive",{vz:-0.5});
document.getElementById("btn-stop").onclick=()=>send("stop");

document.getElementById("btn-camera-usb").onclick=()=>send("camera",{action:"force",camera:"usb"});
document.getElementById("btn-camera-picam").onclick=()=>send("camera",{action:"force",camera:"picam"});
document.getElementById("btn-disable-arm").onclick=()=>send("camera",{action:"disable_arm"});

["base","shoulder","elbow","head"].forEach((id,i)=>{
    document.getElementById(id+"-slider").oninput=e=>{
        send("servo",{channel:i,angle:parseInt(e.target.value)});
    };
});

});
</script>

</body>
</html>
